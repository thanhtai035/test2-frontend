{"ast":null,"code":"/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * \n * See the License for the specific language governing permissions and limitations under the License.\n */\nimport { removeNils, clone } from '../util/object.js';\nimport { isString } from '../util/types.js';\nimport { isAbsoluteUrl } from '../util/url.js';\nimport { STATE_TOKEN_KEY_NAME, DEFAULT_CACHE_DURATION } from '../constants.js';\nimport AuthApiError from '../errors/AuthApiError.js';\nimport OAuthError from '../errors/OAuthError.js';\n\nfunction httpRequest(sdk, options) {\n  options = options || {};\n\n  if (sdk.options.httpRequestInterceptors) {\n    for (const interceptor of sdk.options.httpRequestInterceptors) {\n      interceptor(options);\n    }\n  }\n\n  var url = options.url,\n      method = options.method,\n      args = options.args,\n      saveAuthnState = options.saveAuthnState,\n      accessToken = options.accessToken,\n      withCredentials = options.withCredentials === true,\n      storageUtil = sdk.options.storageUtil,\n      storage = storageUtil.storage,\n      httpCache = sdk.storageManager.getHttpCache(sdk.options.cookies);\n\n  if (options.cacheResponse) {\n    var cacheContents = httpCache.getStorage();\n    var cachedResponse = cacheContents[url];\n\n    if (cachedResponse && Date.now() / 1000 < cachedResponse.expiresAt) {\n      return Promise.resolve(cachedResponse.response);\n    }\n  }\n\n  var oktaUserAgentHeader = sdk._oktaUserAgent.getHttpHeader();\n\n  var headers = Object.assign({\n    'Accept': 'application/json',\n    'Content-Type': 'application/json'\n  }, oktaUserAgentHeader);\n  Object.assign(headers, sdk.options.headers, options.headers);\n  headers = removeNils(headers);\n\n  if (accessToken && isString(accessToken)) {\n    headers['Authorization'] = 'Bearer ' + accessToken;\n  }\n\n  var ajaxOptions = {\n    headers,\n    data: args || undefined,\n    withCredentials\n  };\n  var err, res;\n  return sdk.options.httpRequestClient(method, url, ajaxOptions).then(function (resp) {\n    res = resp.responseText;\n\n    if (res && isString(res)) {\n      res = JSON.parse(res);\n\n      if (res && typeof res === 'object' && !res.headers) {\n        if (Array.isArray(res)) {\n          res.forEach(item => {\n            item.headers = resp.headers;\n          });\n        } else {\n          res.headers = resp.headers;\n        }\n      }\n    }\n\n    if (saveAuthnState) {\n      if (!res.stateToken) {\n        storage.delete(STATE_TOKEN_KEY_NAME);\n      }\n    }\n\n    if (res && res.stateToken && res.expiresAt) {\n      storage.set(STATE_TOKEN_KEY_NAME, res.stateToken, res.expiresAt, sdk.options.cookies);\n    }\n\n    if (res && options.cacheResponse) {\n      httpCache.updateStorage(url, {\n        expiresAt: Math.floor(Date.now() / 1000) + DEFAULT_CACHE_DURATION,\n        response: res\n      });\n    }\n\n    return res;\n  }).catch(function (resp) {\n    var serverErr = resp.responseText || {};\n\n    if (isString(serverErr)) {\n      try {\n        serverErr = JSON.parse(serverErr);\n      } catch (e) {\n        serverErr = {\n          errorSummary: 'Unknown error'\n        };\n      }\n    }\n\n    if (resp.status >= 500) {\n      serverErr.errorSummary = 'Unknown error';\n    }\n\n    if (sdk.options.transformErrorXHR) {\n      resp = sdk.options.transformErrorXHR(clone(resp));\n    }\n\n    if (serverErr.error && serverErr.error_description) {\n      err = new OAuthError(serverErr.error, serverErr.error_description);\n    } else {\n      err = new AuthApiError(serverErr, resp);\n    }\n\n    if (err.errorCode === 'E0000011') {\n      storage.delete(STATE_TOKEN_KEY_NAME);\n    }\n\n    throw err;\n  });\n}\n\nfunction get(sdk, url, options) {\n  url = isAbsoluteUrl(url) ? url : sdk.getIssuerOrigin() + url;\n  var getOptions = {\n    url: url,\n    method: 'GET'\n  };\n  Object.assign(getOptions, options);\n  return httpRequest(sdk, getOptions);\n}\n\nfunction post(sdk, url, args, options) {\n  url = isAbsoluteUrl(url) ? url : sdk.getIssuerOrigin() + url;\n  var postOptions = {\n    url: url,\n    method: 'POST',\n    args: args,\n    saveAuthnState: true\n  };\n  Object.assign(postOptions, options);\n  return httpRequest(sdk, postOptions);\n}\n\nexport { get, httpRequest, post };","map":{"version":3,"mappings":"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","names":["sdk","options","httpRequestInterceptors","interceptor","url","method","args","saveAuthnState","accessToken","withCredentials","storageUtil","storage","httpCache","storageManager","getHttpCache","cookies","cacheResponse","cacheContents","getStorage","cachedResponse","Date","now","expiresAt","Promise","resolve","response","oktaUserAgentHeader","_oktaUserAgent","getHttpHeader","headers","Object","assign","removeNils","isString","ajaxOptions","data","undefined","err","res","httpRequestClient","then","resp","responseText","JSON","parse","Array","isArray","forEach","item","stateToken","delete","STATE_TOKEN_KEY_NAME","set","updateStorage","Math","floor","DEFAULT_CACHE_DURATION","catch","serverErr","e","errorSummary","status","transformErrorXHR","clone","error","error_description","OAuthError","AuthApiError","errorCode","get","isAbsoluteUrl","getIssuerOrigin","getOptions","httpRequest","post","postOptions"],"sources":["C:\\Users\\ADMIN\\Downloads\\okta-springboot-react-master\\okta-springboot-react-master\\test2-s3760615\\node_modules\\@okta\\lib\\http\\request.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-non-null-assertion */\n/*!\n * Copyright (c) 2015-present, Okta, Inc. and/or its affiliates. All rights reserved.\n * The Okta software accompanied by this notice is provided pursuant to the Apache License, Version 2.0 (the \"License.\")\n *\n * You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0.\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *\n * See the License for the specific language governing permissions and limitations under the License.\n *\n */\n\n/* eslint-disable complexity */\nimport { isString, clone, isAbsoluteUrl, removeNils } from '../util';\nimport { STATE_TOKEN_KEY_NAME, DEFAULT_CACHE_DURATION } from '../constants';\nimport {\n  OktaAuthHttpInterface,\n  RequestOptions,\n  FetchOptions,\n  RequestData\n} from '../types';\nimport { AuthApiError, OAuthError } from '../errors';\n\nexport function httpRequest(sdk: OktaAuthHttpInterface, options: RequestOptions): Promise<any> {\n  options = options || {};\n\n  if (sdk.options.httpRequestInterceptors) {\n    for (const interceptor of sdk.options.httpRequestInterceptors) {\n      interceptor(options);\n    }\n  }\n\n  var url = options.url,\n      method = options.method,\n      args = options.args,\n      saveAuthnState = options.saveAuthnState,\n      accessToken = options.accessToken,\n      withCredentials = options.withCredentials === true, // default value is false\n      storageUtil = sdk.options.storageUtil,\n      storage = storageUtil!.storage,\n      httpCache = sdk.storageManager.getHttpCache(sdk.options.cookies);\n\n  if (options.cacheResponse) {\n    var cacheContents = httpCache.getStorage();\n    var cachedResponse = cacheContents[url as string];\n    if (cachedResponse && Date.now()/1000 < cachedResponse.expiresAt) {\n      return Promise.resolve(cachedResponse.response);\n    }\n  }\n\n  var oktaUserAgentHeader = sdk._oktaUserAgent.getHttpHeader();\n  var headers: HeadersInit = {\n    'Accept': 'application/json',\n    'Content-Type': 'application/json',\n    ...oktaUserAgentHeader\n  };\n  Object.assign(headers, sdk.options.headers, options.headers);\n  headers = removeNils(headers) as HeadersInit;\n\n  if (accessToken && isString(accessToken)) {\n    headers['Authorization'] = 'Bearer ' + accessToken;\n  }\n\n  var ajaxOptions: FetchOptions = {\n    headers,\n    data: args || undefined,\n    withCredentials\n  };\n\n  var err, res;\n  return sdk.options.httpRequestClient!(method!, url!, ajaxOptions)\n    .then(function(resp) {\n      res = resp.responseText;\n      if (res && isString(res)) {\n        res = JSON.parse(res);\n        if (res && typeof res === 'object' && !res.headers) {\n          if (Array.isArray(res)) {\n            res.forEach(item => {\n              item.headers = resp.headers;\n            });\n          } else {\n            res.headers = resp.headers;\n          }\n        }\n      }\n\n      if (saveAuthnState) {\n        if (!res.stateToken) {\n          storage.delete(STATE_TOKEN_KEY_NAME);\n        }\n      }\n\n      if (res && res.stateToken && res.expiresAt) {\n        storage.set(STATE_TOKEN_KEY_NAME, res.stateToken, res.expiresAt, sdk.options.cookies!);\n      }\n\n      if (res && options.cacheResponse) {\n        httpCache.updateStorage(url!, {\n          expiresAt: Math.floor(Date.now()/1000) + DEFAULT_CACHE_DURATION,\n          response: res\n        });\n      }\n      \n      return res;\n    })\n    .catch(function(resp) {\n      var serverErr = resp.responseText || {};\n      if (isString(serverErr)) {\n        try {\n          serverErr = JSON.parse(serverErr);\n        } catch (e) {\n          serverErr = {\n            errorSummary: 'Unknown error'\n          };\n        }\n      }\n\n      if (resp.status >= 500) {\n        serverErr.errorSummary = 'Unknown error';\n      }\n\n      if (sdk.options.transformErrorXHR) {\n        resp = sdk.options.transformErrorXHR(clone(resp));\n      }\n\n      if (serverErr.error && serverErr.error_description) {\n        err = new OAuthError(serverErr.error, serverErr.error_description);\n      } else {\n        err = new AuthApiError(serverErr, resp);\n      }\n\n      if (err.errorCode === 'E0000011') {\n        storage.delete(STATE_TOKEN_KEY_NAME);\n      }\n\n      throw err;\n    });\n}\n\nexport function get(sdk: OktaAuthHttpInterface, url: string, options?: RequestOptions) {\n  url = isAbsoluteUrl(url) ? url : sdk.getIssuerOrigin() + url;\n  var getOptions = {\n    url: url,\n    method: 'GET'\n  };\n  Object.assign(getOptions, options);\n  return httpRequest(sdk, getOptions);\n}\n\nexport function post(sdk: OktaAuthHttpInterface, url: string, args?: RequestData, options?: RequestOptions) {\n  url = isAbsoluteUrl(url) ? url : sdk.getIssuerOrigin() + url;\n  var postOptions = {\n    url: url,\n    method: 'POST',\n    args: args,\n    saveAuthnState: true\n  };\n  Object.assign(postOptions, options);\n  return httpRequest(sdk, postOptions);\n}\n"]},"metadata":{},"sourceType":"module"}